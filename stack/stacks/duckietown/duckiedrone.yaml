services:

  dtps:
    image: ${REGISTRY}/duckietown/dtps-switchboard:release
    container_name: dtps
    restart: unless-stopped
    network_mode: host
    environment:
      RUST_LOG: "warn,dtps_http=info"
    command: --tcp-port 11511 --tcp-host 0.0.0.0 --unix-path /dtps/switchboard.sock
    privileged: true
    volumes:
      # dtps sockets
      - /data/ramdisk/dtps:/dtps
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket

  driver-camera:
    image: ${REGISTRY}/duckietown/dt-duckiebot-interface:ente-${ARCH}
    container_name: driver-camera
    restart: unless-stopped
    network_mode: host
    privileged: true
    pid: host
    environment:
      DT_SUPERUSER: 1
      DT_LAUNCHER: sensor-camera
    volumes:
      - /data:/data
      # dtps sockets
      - /data/ramdisk/dtps:/dtps
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket
      # nvargus socket
      - /tmp:/tmp

  driver-tof:
    image: ${REGISTRY}/duckietown/dt-duckiebot-interface:ente-${ARCH}
    container_name: driver-tof
    restart: unless-stopped
    network_mode: host
    privileged: true
    environment:
      DT_SUPERUSER: 1
      DT_LAUNCHER: sensor-tof
    volumes:
      - /data:/data
      # dtps sockets
      - /data/ramdisk/dtps:/dtps
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket

  # driver-flight-controller:
  #   image: ${REGISTRY}/duckietown/dt-duckiebot-interface:ente-${ARCH}
  #   container_name: driver-flight-controller
  #   restart: unless-stopped
  #   network_mode: host
  #   privileged: true
  #   environment:
  #     DT_SUPERUSER: 1
  #     DT_LAUNCHER: flight-controller
  #   volumes:
  #     - /data:/data
  #     # dtps sockets
  #     - /data/ramdisk/dtps:/dtps
  #     # avahi socket
  #     - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket

  dashboard:
    image: ${REGISTRY}/duckietown/dt-device-dashboard:ente-${ARCH}
    container_name: dashboard
    restart: unless-stopped
    network_mode: host
    environment:
      HTTP_PORT: 8080
    volumes:
      - /data:/data
      # dtps sockets
      - /data/ramdisk/dtps:/dtps
      # secrets
      - /secrets:/secrets
      # compose volume
      - compose-data:/user-data/databases
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket

  files-api:
    image: ${REGISTRY}/duckietown/dt-files-api:ente-${ARCH}
    container_name: files-api
    restart: always
    network_mode: host
    volumes:
      - /data:/data
      # dtps sockets
      - /data/ramdisk/dtps:/dtps
      # secrets
      - /secrets:/secrets
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket

  code-api:
    image: ${REGISTRY}/duckietown/dt-code-api:ente-${ARCH}
    container_name: code-api
    restart: always
    network_mode: host
    volumes:
      - /data:/data
      # dtps sockets
      - /data/ramdisk/dtps:/dtps
      # user code
      - /code:/user_code
      # docker socket
      - /var/run/docker.sock:/var/run/docker.sock
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket

  device-proxy:
    image: ${REGISTRY}/duckietown/dt-device-proxy:ente-${ARCH}
    container_name: device-proxy
    restart: always
    network_mode: host
    environment:
      DT_SUPERUSER: 1
    volumes:
      - /data:/data
      # dtps sockets
      - /data/ramdisk/dtps:/dtps
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket

  device-health:
    image: ${REGISTRY}/duckietown/dt-device-health:ente-${ARCH}
    container_name: device-health
    restart: always
    network_mode: host
    privileged: true
    volumes:
      - /data:/data
      # dtps sockets
      - /data/ramdisk/dtps:/dtps
      # triggers
      - /triggers:/triggers
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket

  device-online:
    image: ${REGISTRY}/duckietown/dt-device-online:ente-${ARCH}
    container_name: device-online
    restart: always
    network_mode: host
    volumes:
      - /data:/data
      # dtps sockets
      - /data/ramdisk/dtps:/dtps
      # secrets
      - /secrets:/secrets
      # docker socket
      - /var/run/docker.sock:/var/run/docker.sock
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket

  wifi-access-point:
    image: ${REGISTRY}/duckietown/dt-wifi-access-point:ente-${ARCH}
    container_name: wifi-access-point
    restart: unless-stopped
    network_mode: host
    privileged: true
    volumes:
      - /data:/data
      # dtps sockets
      - /data/ramdisk/dtps:/dtps
      # host triggers
      - /triggers:/triggers
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket

volumes:
  compose-data:
  portainer-data: